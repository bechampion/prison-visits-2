<%= render 'banner' %>
<%= render 'navigation', estate: @estate %>

<h2 class="heading-large"><%= t('.title') %></h2>

<div class='grid-row'>
  <div class='column-one-half'>
<%= form_tag prison_processed_visits_path(@estate.finder_slug), method: :get, enforce_utf8: false, class: 'form' do -%>
  <div class="form-group">
    <%= label_tag "prisoner_number", class: "form-label-bold" do -%>
      <%= t('search', scope: :shared) %>
      <span class="form-hint">
        <%= t('.filter_form_hint') %>
      </span>
    <% end %>
    <%= text_field_tag 'prisoner_number', params[:prisoner_number], class: 'form-control' %>
    <%= submit_tag t('search', scope: :shared), name: nil, class: 'button' %>
  </div>
<% end -%>
</div>
</div>


<% if @processed_visits.any? %>

  <table class="table--hover">
    <caption class="visuallyhidden"><%= t('.title') %></caption>
    <thead>
      <tr>
        <th><%= t('prisoner_number', scope: :shared) %></th>
        <th><%= t('prisoner_name', scope: :shared) %></th>
        <th><%= t('lead_visitor', scope: :shared) %></th>
        <th><%= t('visit_date', scope: :shared) %></th>
        <th class="col-time"><%= t('time_slot', scope: :shared) %></th>
        <th><%= t('status', scope: :shared) %></th>
        <th><%= t('processed_on', scope: :shared) %></th>
        <th class="col-actions"><%= t('actions', scope: :shared) %></th>
      </tr>
    </thead>
    <tbody>
      <% @processed_visits.each do |visit| %>
        <tr onclick="window.document.location='<%= prison_visit_show_path(visit) %>';">
          <td><%= visit.prisoner_number %></td>
          <td class="long"><%= visit.prisoner_full_name %></td>
          <td class="long"><%= visit.visitor_full_name %></td>
          <td><%= visit.slots.first.to_date.to_s(:short_nomis) %></td>
          <td><%= format_slot_times(visit.slots.first) %></td>
          <td><span class="tag tag-<%= visit.processing_state %>"><%= visit.processing_state.capitalize %></span></td>
          <td><%= visit.updated_at.to_s(:short) %></td>
          <td><%= link_to t('.view_link'), prison_visit_show_path(visit) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% unless @all_visits_shown %>
    <p class="text-secondary"><%= t('not_all_visits', scope: :shared) %></p>
  <% end %>
<% else %>

  <p class="lede"><%= t('no_visits', scope: :shared) %></p>

<% end %>
